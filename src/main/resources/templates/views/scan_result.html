<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Scan Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            max-width: 980px;
            margin: 2rem auto;
            font-family: system-ui, Arial, sans-serif;
            line-height: 1.5;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1rem;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }

        .card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            background: #f4f4f4;
        }

        .muted {
            color: #666;
            font-size: .9rem;
        }

        a.button {
            display: inline-block;
            padding: .5rem .9rem;
            border-radius: 10px;
            background: #222;
            color: #fff;
            text-decoration: none;
        }

        .empty {
            border: 1px dashed #bbb;
            border-radius: 12px;
            padding: 1rem;
        }

        .toolbar {
            display: flex;
            gap: .5rem;
            align-items: center;
        }

        select, input[type="file"] {
            padding: .4rem .5rem;
        }
    </style>
</head>
<body>
<header>
    <h1>Scan Result</h1>

    <!-- Quick re-scan form keeps chosen lang -->
    <form class="toolbar" th:action="@{/scan}" method="post" enctype="multipart/form-data">
        <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> -->
        <label for="lang" class="muted">Language</label>
        <select id="lang" name="lang" required>
            <option th:each="lc : ${T(com.scankorea.server.common.constant.LanguageCode).values()}"
                    th:selected="${#strings.equals(lc, param.lang)}"
                    th:value="${lc}"
                    th:text="${lc}">EN
            </option>
        </select>
        <input type="file" name="file" accept="image/*" required>
        <button type="submit">Re-scan</button>
        <a th:href="@{'/scan'}" class="button" style="background:#555;">Back</a>
    </form>
</header>

<main>
    <div th:if="${#lists.isEmpty(products)}" class="empty">
        No products found. Try a clearer photo or a different angle.
    </div>

    <div class="grid" th:if="${!#lists.isEmpty(products)}">
        <article class="card" th:each="p : ${products}">
            <img th:if="${p.imageUrl}" th:src="${p.imageUrl}" alt="Product image">
            <div>
                <div class="muted" th:text="${p.brandName}">Brand</div>
                <h3 th:text="${p.displayName}">Product Name</h3>
                <div class="muted">
                    <span>GTIN: </span><span th:text="${p.gtin}">0000000000000</span>
                    <span th:if="${p.verified}" style="margin-left:.4rem;">Â· Verified</span>
                </div>
            </div>
            <p th:text="${p.description}">Description...</p>

            <div>
                <a class="button"
                   th:href="@{/p/{gtin}(gtin=${p.gtin}, lang=${param.lang})}">
                    View details
                </a>
            </div>
        </article>
    </div>
</main>
</body>
</html>
